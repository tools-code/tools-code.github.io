<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>JSON解析器在线 - 免费JSON格式化与验证工具</title>
    <meta name="description" content="无需安装，在线JSON格式化、验证、解析工具，支持语法高亮、错误提示、复制、清空等功能。">
    <meta name="keywords" content="JSON解析器,JSON格式化,JSON验证,在线JSON工具">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="baidu-site-verification" content="codeva-vpfc6UOMEK" />
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/jsoneditor/10.2.0/jsoneditor.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/jsoneditor/10.2.0/jsoneditor.min.js"></script>
</head>

<body>
    <!-- 顶部菜单栏 -->
    <div class="topbar">
        <a href="index.html" class="active">首页</a>
        <a href="docs.html">文章页</a>
    </div>

    <div class="shell">
        <h1 class="page-title">JSON解析器在线</h1>
        <div class="subtitle">免费、高效的JSON格式化与验证工具</div>
        
        <div class="nav">
            <div class="brand">
                <span class="dot"></span>
                <span>JSON 解析器</span>
            </div>
            <div class="controls">
                    <button class="btn info" onclick="loadSample()">示例</button>
                    <button class="btn success" onclick="formatJSON()">格式化</button>
                    <button class="btn warning" onclick="minifyJSON()">压缩</button>
                    <button class="btn secondary" onclick="validateJSON()">验证</button>
                    <button class="btn danger" onclick="clearText()">清空</button>
                </div>
        </div>

        <div id="alert" class="alert"></div>

        <div class="card json-editor-card">
            <div class="editor-header">
                <div class="editor-stats" id="jsonStats">字符数: 0 | 行数: 0</div>
            </div>
            
            <div class="editor-container">
                <div class="editor-panel left-panel">
                    <div class="panel-title">代码视图</div>
                    <div id="codeEditor" style="width: 100%; height: 450px;"></div>
                </div>
                <div class="editor-divider"></div>
                <div class="editor-panel right-panel">
                    <div class="panel-title">树视图</div>
                    <div id="treeEditor" style="width: 100%; height: 450px;"></div>
                </div>
            </div>
        </div>

        <div class="features-container">
            <div class="feature-card">
                <div class="feature-icon">✨</div>
                <div class="feature-title">语法高亮</div>
                <div class="feature-desc">智能识别JSON语法，提供清晰的代码高亮显示，提升阅读体验</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">📝</div>
                <div class="feature-title">格式化与压缩</div>
                <div class="feature-desc">一键格式化JSON，使其易于阅读；或压缩JSON，减少数据体积</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">✅</div>
                <div class="feature-title">实时验证</div>
                <div class="feature-desc">实时检测JSON语法错误，提供准确的错误提示和位置信息</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🔄</div>
                <div class="feature-title">视图转换</div>
                <div class="feature-desc">代码视图接收输入，格式化结果在树视图显示，压缩功能优化代码视图</div>
            </div>
        </div>

        <div class="remark">
            <h3>什么是JSON？</h3>
            <p>
                <strong>JSON（JavaScript Object Notation）</strong> 是一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。它基于 JavaScript 编程语言的一个子集，但采用完全独立于语言的文本格式。
            </p>

            <h3>为什么使用JSON？</h3>
            <p>
                JSON已成为Web应用程序中最常用的数据交换格式，被广泛应用于API交互、配置文件、数据存储等场景。它比XML更简洁，解析速度更快，并且被几乎所有主流编程语言支持。
            </p>
        </div>

        <div class="wise_saying">
            <b>工欲善其事，必先利其器。——《论语·卫灵公》</b>
        </div>

        <div class="footer">
            <!-- 友链直接硬编码在这里 -->
            <div class="friend-links">
                <h3>友情链接</h3>
                <div class="links-container">
                    <a href="./website/sitemap.xml" target="_blank" rel="noopener">站点地图</a>
                    <a href="https://m3u8play502.github.io" target="_blank" rel="noopener">M3U8在线播放</a>
                    <a href="https://www.csdn.net/" target="_blank" rel="noopener">CSDN</a>
                    <a href="https://www.cnblogs.com/" target="_blank" rel="noopener">博客园</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化示例JSON数据
        const initialSample = {
            "name": "JSON解析器",
            "version": "1.0.0",
            "description": "在线JSON格式化与验证工具",
            "features": [
                "语法高亮",
                "错误提示",
                "JSON格式化",
                "JSON压缩",
                "一键复制"
            ],
            "isActive": true,
            "count": 0
        };

        // 页面元素
        const alert = document.getElementById('alert');
        const jsonStats = document.getElementById('jsonStats');
        let codeEditor = null;
        let treeEditor = null;

        // 显示提示信息
        function showAlert(text, isError = false) {
            alert.textContent = text;
            alert.style.display = text ? 'block' : 'none';
            alert.style.color = isError ? '#ef4444' : '#0f766e';
            
            // 添加动画效果
            alert.style.animation = 'none';
            alert.offsetHeight; // 触发重排
            alert.style.animation = isError ? 'shake 0.5s' : 'fadeIn 0.5s';
        }

        // 初始化代码编辑器
        function initCodeEditor() {
            try {
                const container = document.getElementById('codeEditor');
                if (!container) {
                    showAlert('代码编辑器容器未找到', true);
                    return;
                }
                
                const options = {
                    mode: 'code',
                    modes: ['code'],
                    search: true,
                    history: true,
                    mainMenuBar: false,
                    navigationBar: false,
                    statusBar: false,
                    onValidate: function (json) {
                        try {
                            JSON.parse(JSON.stringify(json));
                            return { valid: true };
                        } catch (error) {
                            return { valid: false, errors: [error] };
                        }
                    },
                    onError: function (error) {
                        showAlert(`代码编辑器错误: ${error}`, true);
                    }
                };

                // 创建编辑器
                codeEditor = new JSONEditor(container, options);
                
                // 设置初始数据
                codeEditor.set(initialSample);
                
                // 监听变化更新统计 - 方法1: 事件监听
                try {
                    // 尝试使用on方法
                    if (typeof codeEditor.on === 'function') {
                        codeEditor.on('change', function() {
                            try {
                                updateStats();
                            } catch (error) {
                                // 更新失败时不显示错误
                            }
                        });
                    } 
                    // 尝试使用其他可能的事件监听方法（根据不同版本的API）
                    else if (typeof codeEditor.addEventListener === 'function') {
                        codeEditor.addEventListener('change', function() {
                            try {
                                updateStats();
                            } catch (error) {
                                // 更新失败时不显示错误
                            }
                        });
                    } else {
                        console.warn('未找到适合的事件监听方法');
                    }
                } catch (error) {
                    console.error('设置事件监听失败:', error);
                }
                
                // 方法2: 添加定时器定期更新（确保实时更新）
                try {
                    // 每500毫秒更新一次统计信息
                    setInterval(function() {
                        try {
                            if (codeEditor) {
                                updateStats();
                            }
                        } catch (error) {
                            // 更新失败时不显示错误
                        }
                    }, 500);
                } catch (error) {
                    console.error('设置定期更新失败:', error);
                }
            } catch (error) {
                showAlert(`代码编辑器初始化失败: ${error.message}`, true);
                console.error('代码编辑器初始化错误:', error);
            }
        }

        // 初始化树编辑器（只读模式）
        function initTreeEditor() {
            try {
                const container = document.getElementById('treeEditor');
                if (!container) {
                    showAlert('树编辑器容器未找到', true);
                    return;
                }
                
                const options = {
                    mode: 'tree',
                    modes: ['tree'],
                    search: true,
                    history: false, // 禁用历史记录
                    mainMenuBar: false,
                    navigationBar: false,
                    statusBar: false,
                    onValidate: function (json) {
                        try {
                            JSON.parse(JSON.stringify(json));
                            return { valid: true };
                        } catch (error) {
                            return { valid: false, errors: [error] };
                        }
                    },
                    onError: function (error) {
                        showAlert(`树编辑器错误: ${error}`, true);
                    }
                };

                // 创建编辑器
                treeEditor = new JSONEditor(container, options);
                
                // 设置初始数据
                treeEditor.set(initialSample);
                
                // 树视图不监听变化，仅用于显示
            } catch (error) {
                showAlert(`树编辑器初始化失败: ${error.message}`, true);
                console.error('树编辑器初始化错误:', error);
            }
        }

        // 加载示例数据（只设置代码视图）
        function loadSample() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                
                codeEditor.set(initialSample);
                updateStats();
                showAlert('已加载示例JSON数据');
            } catch (error) {
                showAlert(`加载示例失败: ${error.message}`, true);
            }
        }

        // 格式化JSON（将代码视图的JSON数据格式化后在树视图显示，同时美化代码视图）
        function formatJSON() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                if (!treeEditor) {
                    showAlert('树编辑器未初始化', true);
                    return;
                }
                
                // 从代码编辑器获取原始JSON数据
                const json = codeEditor.get();
                // 将代码视图的数据在树视图中格式化显示
                treeEditor.set(json);
                // 同时美化代码视图
                beautifyCodeView();
            } catch (error) {
                showAlert(`格式化失败: ${error.message}`, true);
                // 格式化失败时清空树视图
                if (treeEditor) {
                    try {
                        treeEditor.set({});
                    } catch (clearError) {
                        console.error('清空树视图失败:', clearError);
                    }
                }
            }
        }

        // 压缩JSON（应用于代码视图）
        function minifyJSON() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                
                // 从代码编辑器获取数据
                const json = codeEditor.get();
                // 转换为压缩的JSON字符串并应用于代码视图
                const minifiedJson = JSON.stringify(json);
                codeEditor.setText(minifiedJson);
                updateStats(); // 更新统计信息
                showAlert('代码视图已压缩');
            } catch (error) {
                showAlert(`压缩失败: ${error.message}`, true);
            }
        }

        // 美化代码视图
        function beautifyCodeView() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                
                // 从代码编辑器获取数据
                const json = codeEditor.get();
                // 转换为格式化的JSON字符串并应用于代码视图
                const beautifiedJson = JSON.stringify(json, null, 2);
                codeEditor.setText(beautifiedJson);
                updateStats(); // 更新统计信息
                showAlert('代码视图已美化');
            } catch (error) {
                showAlert(`美化失败: ${error.message}`, true);
            }
        }
        
        // 验证JSON
        function validateJSON() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                
                // 从代码编辑器获取数据
                const json = codeEditor.get();
                // 使用JSON.stringify和JSON.parse来验证
                const jsonStr = JSON.stringify(json);
                JSON.parse(jsonStr);
                showAlert('JSON格式有效');
            } catch (error) {
                showAlert(`JSON格式无效: ${error.message}`, true);
            }
        }

        // 清空文本（同时清空代码视图和树视图）
        function clearText() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                
                codeEditor.set({});
                updateStats();
                
                // 同时清空树视图
                if (treeEditor) {
                    try {
                        treeEditor.set({});
                    } catch (treeClearError) {
                        console.error('清空树视图失败:', treeClearError);
                    }
                }
                
                showAlert('');
            } catch (error) {
                showAlert(`清空失败: ${error.message}`, true);
            }
        }

        // 复制JSON
        function copyJSON() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    showAlert('代码编辑器未初始化', true);
                    return;
                }
                
                // 从代码编辑器获取数据
                const json = codeEditor.get();
                const jsonStr = JSON.stringify(json, null, 2);
                
                navigator.clipboard.writeText(jsonStr).then(function() {
                    showAlert('已复制到剪贴板');
                }).catch(function(err) {
                    showAlert(`复制失败: ${err.message}`, true);
                });
            } catch (error) {
                showAlert(`复制失败: ${error.message}`, true);
            }
        }

        // 更新统计信息
        function updateStats() {
            try {
                // 检查编辑器是否初始化
                if (!codeEditor) {
                    return;
                }
                
                // 从代码编辑器获取数据
                const json = codeEditor.get();
                const jsonStr = JSON.stringify(json);
                const charCount = jsonStr.length;
                const lineCount = jsonStr.split('\n').length;
                jsonStats.textContent = `字符数: ${charCount} | 行数: ${lineCount}`;
            } catch (error) {
                // 出错时不更新统计
            }
        }

        // 页面加载时初始化
        window.addEventListener('DOMContentLoaded', function () {
            initCodeEditor();
            initTreeEditor();
            updateStats();
        });
    </script>
</body>

</html>
