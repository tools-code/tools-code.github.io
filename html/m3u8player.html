<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U8在线播放器 - 免费在线M3U8视频解析播放工具</title>
    <meta name="description" content="免费在线M3U8播放器，无需下载，直接播放M3U8格式视频，支持HLS流媒体播放，提供播放速度调节、清晰度切换等功能。">
    <meta name="keywords" content="M3U8播放器,在线M3U8播放,HLS播放器,M3U8解析工具,在线视频播放">

    <!-- 引入外部资源 -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 引入自定义样式 -->
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- 顶部菜单栏 - 参照jyshare.com样式 -->
    <div class="topbar">
        <div class="nav">
            <div class="navbar-brand">
                <a href="/">
                    <i class="fas fa-code"></i>
                </a>
            </div>
            <div class="nav-links">
                <a href="/html/jsonformat.html">JSON格式化</a>
                <a href="/html/m3u8player.html" class="active" target="_blank" rel="noopener">M3U8在线播放</a>
                <a href="/html/timestampconverter.html" >时间戳转换</a>
                <a href="/html/regextool.html">正则表达式</a>
                <a href="/html/qrcodegenerator.html">二维码生成</a>
                <a href="/docs.html">文章页</a>
            </div>
        </div>
    </div>

    <div class="shell">
        <div id="alert" class="alert"></div>

        <div style="margin: 0px 16px;">
            <section class="section-title">
                <h1>M3U8在线播放器</h1>
                <p>免费在线播放M3U8格式视频，无需下载任何软件</p>
            </section>

            <!-- 播放器区域 -->
            <section class="player-section">
                <div class="player-container">
                    <div class="input-group">
                        <input type="text" id="m3u8Url" placeholder="请输入M3U8文件地址"
                            value="https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8">
                        <button class="btn primary" id="playBtn"><i class="fas fa-play"></i> 播放</button>
                    </div>

                    <!-- 播放器控件 -->
                    <div class="player-controls">
                        <button class="btn info" id="sampleBtn"><i class="fas fa-file-video"></i> 示例视频</button>
                        <button class="btn danger" id="clearBtn"><i class="fas fa-times"></i> 清空</button>
                        <div class="speed-control">
                            <label for="playbackSpeed">播放速度:</label>
                            <select id="playbackSpeed">
                                <option value="0.5">0.5x</option>
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1.0x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2.0x</option>
                            </select>
                        </div>
                    </div>

                    <!-- 视频播放器 -->
                    <div class="video-player-wrapper">
                        <div class="loading-overlay" id="loadingOverlay">
                            <div class="loading-spinner"></div>
                            <p>加载中...</p>
                        </div>
                        <video id="videoPlayer" class="video-player" controls></video>
                    </div>

                    <!-- 清晰度选择 -->
                    <div class="quality-control">
                        <label>清晰度:</label>
                        <div id="qualitySelect" class="quality-options">
                            <span class="quality-option">自动</span>
                        </div>
                    </div>
                </div>
            </section>

            <div class="features-container">
                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <div class="feature-title">快速解析</div>
                    <div class="feature-desc">快速解析M3U8视频链接，无需等待</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">⏩</div>
                    <div class="feature-title">多倍速播放</div>
                    <div class="feature-desc">支持0.5x-2.0x多种播放速度调节</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📺</div>
                    <div class="feature-title">清晰度选择</div>
                    <div class="feature-desc">自动识别并支持多种清晰度切换</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔒</div>
                    <div class="feature-title">安全播放</div>
                    <div class="feature-desc">本地播放，保护您的隐私安全</div>
                </div>
            </div>

            <div class="remark">
                <h3>什么是M3U8？</h3>
                <p>
                    <strong>M3U8</strong> 是一种基于HTTP Live
                    Streaming（HLS）协议的视频播放格式，常用于在线视频播放。它将视频分割成多个小的TS格式文件，通过m3u8索引文件进行管理和加载。
                </p>

                <h3>如何使用本工具？</h3>
                <p>
                    1. 在输入框中粘贴您的M3U8视频文件链接<br>
                    2. 点击播放按钮，系统将自动解析并播放视频<br>
                    3. 您可以根据需要调整播放速度和清晰度
                </p>
            </div>

            <div class="wise_saying">
                <b>工欲善其事，必先利其器。——《论语·卫灵公》</b>
            </div>

            <div class="footer">
                <!-- 友链直接硬编码在这里 -->
                <div class="friend-links">
                    <h3>友情链接</h3>
                    <div class="links-container">
                        <a href="/website/sitemap.xml" target="_blank" rel="noopener">站点地图</a>
                        <a href="https://www.csdn.net/" target="_blank" rel="noopener">CSDN</a>
                        <a href="https://www.cnblogs.com/" target="_blank" rel="noopener">博客园</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="alert" class="alert"></div>

    <!-- JavaScript -->
    <script>
        // 页面元素
        const m3u8Url = document.getElementById('m3u8Url');
        const playBtn = document.getElementById('playBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const clearBtn = document.getElementById('clearBtn');
        const videoPlayer = document.getElementById('videoPlayer');
        const playbackSpeed = document.getElementById('playbackSpeed');
        const qualitySelect = document.getElementById('qualitySelect');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const alert = document.getElementById('alert');

        // HLS实例
        let hls = null;

        // 显示提示信息
        function showAlert(text, isError = false) {
            alert.textContent = text;
            alert.style.display = text ? 'block' : 'none';
            alert.style.color = isError ? '#ef4444' : '#0f766e';

            // 添加动画效果
            alert.style.opacity = 1;
            alert.style.animation = 'none';
            alert.offsetHeight; // 触发重排
            alert.style.animation = isError ? 'shake 0.5s' : 'fadeIn 0.5s';

            // 3秒后自动隐藏
            if (text) {
                setTimeout(() => {
                    alert.style.opacity = 0;
                    setTimeout(() => {
                        alert.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        }

        // 显示加载状态
        function showLoading(show = true) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }

        // 播放M3U8视频
        function playM3U8(url) {
            // 验证URL
            if (!url || !url.trim()) {
                showAlert('请输入有效的M3U8链接', true);
                return;
            }

            // 重置播放器
            if (hls) {
                hls.destroy();
                hls = null;
            }

            videoPlayer.pause();
            videoPlayer.src = '';

            showLoading();

            try {
                // 检查浏览器是否支持HLS
                if (Hls.isSupported()) {
                    hls = new Hls();

                    // 监听错误
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        console.error('HLS错误:', data);
                        showLoading(false);

                        if (data.fatal) {
                            switch (data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    showAlert('网络错误，请检查链接是否有效', true);
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    showAlert('媒体错误，无法播放视频', true);
                                    break;
                                default:
                                    showAlert('播放错误: ' + data.details, true);
                                    break;
                            }
                        }
                    });

                    // 监听加载进度
                    hls.on(Hls.Events.BUFFER_CREATED, () => {
                        showLoading(false);
                    });

                    // 监听清晰度变化
                    hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                        updateQualitySelection();
                    });

                    // 监听清晰度列表加载完成
                    hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
                        updateQualitySelection();
                        showLoading(false);
                    });

                    // 加载M3U8源
                    hls.loadSource(url);
                    hls.attachMedia(videoPlayer);
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    // Safari浏览器原生支持HLS
                    videoPlayer.src = url;
                    videoPlayer.addEventListener('loadedmetadata', () => {
                        showLoading(false);
                    });
                    videoPlayer.addEventListener('error', (err) => {
                        showLoading(false);
                        showAlert('播放错误，请检查链接是否有效', true);
                        console.error('视频播放错误:', err);
                    });
                } else {
                    showLoading(false);
                    showAlert('您的浏览器不支持M3U8播放，请更换浏览器或使用Chrome/Firefox/Edge', true);
                }
            } catch (error) {
                showLoading(false);
                showAlert('播放错误: ' + error.message, true);
                console.error('播放M3U8视频时出错:', error);
            }
        }

        // 更新清晰度选择
        function updateQualitySelection() {
            if (!hls || !hls.levels || hls.levels.length <= 0) {
                return;
            }

            qualitySelect.innerHTML = '';

            // 添加自动选项
            const autoOption = document.createElement('span');
            autoOption.className = 'quality-option active';
            autoOption.textContent = '自动';
            autoOption.addEventListener('click', () => {
                if (hls) {
                    hls.currentLevel = -1; // 设置为自动
                    updateActiveQuality(autoOption);
                    showAlert('已切换为自动清晰度');
                }
            });
            qualitySelect.appendChild(autoOption);

            // 添加各清晰度选项
            hls.levels.forEach((level, index) => {
                const bitrate = level.bitrate || 0;
                const bandwidth = (bitrate / 1000000).toFixed(2);
                const option = document.createElement('span');
                option.className = 'quality-option';
                option.textContent = `${level.width || '未知'}p (${bandwidth}Mbps)`;
                option.addEventListener('click', () => {
                    if (hls) {
                        hls.currentLevel = index;
                        updateActiveQuality(option);
                        showAlert(`已切换为${option.textContent}清晰度`);
                    }
                });
                qualitySelect.appendChild(option);
            });
        }

        // 更新激活的清晰度选项
        function updateActiveQuality(element) {
            const options = document.querySelectorAll('.quality-option');
            options.forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
        }

        // 设置示例视频
        function setSampleVideo() {
            // 多个示例视频链接，可以随机选择或循环使用
            const sampleVideos = [
                'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
                'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                'https://playertest.longtailvideo.com/adaptive/bipbop/gear4/prog_index.m3u8'
            ];

            // 随机选择一个示例视频
            const randomIndex = Math.floor(Math.random() * sampleVideos.length);
            m3u8Url.value = sampleVideos[randomIndex];

            // 自动播放
            playM3U8(m3u8Url.value);
            showAlert('已加载示例视频');
        }

        // 清空输入和播放器
        function clearPlayer() {
            if (hls) {
                hls.destroy();
                hls = null;
            }

            videoPlayer.pause();
            videoPlayer.src = '';
            m3u8Url.value = '';
            qualitySelect.innerHTML = '<span class="quality-option">自动</span>';
            playbackSpeed.value = '1';
            showAlert('播放器已清空');
        }

        // 事件监听
        playBtn.addEventListener('click', () => playM3U8(m3u8Url.value));
        sampleBtn.addEventListener('click', setSampleVideo);
        clearBtn.addEventListener('click', clearPlayer);

        // 播放速度调节
        playbackSpeed.addEventListener('change', (e) => {
            videoPlayer.playbackRate = parseFloat(e.target.value);
            showAlert(`播放速度已调整为${e.target.value}x`);
        });

        // 支持回车播放
        m3u8Url.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                playM3U8(m3u8Url.value);
            }
        });

        // 页面加载完成后自动尝试加载示例视频
        window.addEventListener('DOMContentLoaded', () => {
            // 显示欢迎信息
            showAlert('欢迎使用M3U8在线播放器，请输入链接或点击示例视频开始播放');

            // 如果URL中有参数，则自动加载
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url');
            if (url) {
                m3u8Url.value = url;
                setTimeout(() => playM3U8(url), 500);
            }
        });
    </script>
</body>

</html>