<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U8åœ¨çº¿æ’­æ”¾å™¨ - å…è´¹åœ¨çº¿M3U8è§†é¢‘è§£ææ’­æ”¾å·¥å…·</title>
    <meta name="description" content="å…è´¹åœ¨çº¿M3U8æ’­æ”¾å™¨ï¼Œæ— éœ€ä¸‹è½½ï¼Œç›´æ¥æ’­æ”¾M3U8æ ¼å¼è§†é¢‘ï¼Œæ”¯æŒHLSæµåª’ä½“æ’­æ”¾ï¼Œæä¾›æ’­æ”¾é€Ÿåº¦è°ƒèŠ‚ã€æ¸…æ™°åº¦åˆ‡æ¢ç­‰åŠŸèƒ½ã€‚">
    <meta name="keywords" content="M3U8æ’­æ”¾å™¨,åœ¨çº¿M3U8æ’­æ”¾,HLSæ’­æ”¾å™¨,M3U8è§£æå·¥å…·,åœ¨çº¿è§†é¢‘æ’­æ”¾">

    <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- å¼•å…¥è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- é¡¶éƒ¨èœå•æ  - å‚ç…§jyshare.comæ ·å¼ -->
    <div class="topbar">
        <div class="nav">
            <div class="navbar-brand">
                <a href="/">
                    <i class="fas fa-code"></i>
                </a>
            </div>
            <div class="nav-links">
                <a href="/html/jsonformat.html">JSONæ ¼å¼åŒ–</a>
                <a href="/html/m3u8player.html" class="active" target="_blank" rel="noopener">M3U8åœ¨çº¿æ’­æ”¾</a>
                <a href="/html/timestampconverter.html" >æ—¶é—´æˆ³è½¬æ¢</a>
                <a href="/html/regextool.html">æ­£åˆ™è¡¨è¾¾å¼</a>
                <a href="/html/qrcodegenerator.html">äºŒç»´ç ç”Ÿæˆ</a>
                <a href="/docs.html">æ–‡ç« é¡µ</a>
            </div>
        </div>
    </div>

    <div class="shell">
        <div id="alert" class="alert"></div>

        <div style="margin: 0px 16px;">
            <section class="section-title">
                <h1>M3U8åœ¨çº¿æ’­æ”¾å™¨</h1>
                <p>å…è´¹åœ¨çº¿æ’­æ”¾M3U8æ ¼å¼è§†é¢‘ï¼Œæ— éœ€ä¸‹è½½ä»»ä½•è½¯ä»¶</p>
            </section>

            <!-- æ’­æ”¾å™¨åŒºåŸŸ -->
            <section class="player-section">
                <div class="player-container">
                    <div class="input-group">
                        <input type="text" id="m3u8Url" placeholder="è¯·è¾“å…¥M3U8æ–‡ä»¶åœ°å€"
                            value="https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8">
                        <button class="btn primary" id="playBtn"><i class="fas fa-play"></i> æ’­æ”¾</button>
                    </div>

                    <!-- æ’­æ”¾å™¨æ§ä»¶ -->
                    <div class="player-controls">
                        <button class="btn info" id="sampleBtn"><i class="fas fa-file-video"></i> ç¤ºä¾‹è§†é¢‘</button>
                        <button class="btn danger" id="clearBtn"><i class="fas fa-times"></i> æ¸…ç©º</button>
                        <div class="speed-control">
                            <label for="playbackSpeed">æ’­æ”¾é€Ÿåº¦:</label>
                            <select id="playbackSpeed">
                                <option value="0.5">0.5x</option>
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1.0x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2.0x</option>
                            </select>
                        </div>
                    </div>

                    <!-- è§†é¢‘æ’­æ”¾å™¨ -->
                    <div class="video-player-wrapper">
                        <div class="loading-overlay" id="loadingOverlay">
                            <div class="loading-spinner"></div>
                            <p>åŠ è½½ä¸­...</p>
                        </div>
                        <video id="videoPlayer" class="video-player" controls></video>
                    </div>

                    <!-- æ¸…æ™°åº¦é€‰æ‹© -->
                    <div class="quality-control">
                        <label>æ¸…æ™°åº¦:</label>
                        <div id="qualitySelect" class="quality-options">
                            <span class="quality-option">è‡ªåŠ¨</span>
                        </div>
                    </div>
                </div>
            </section>

            <div class="features-container">
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <div class="feature-title">å¿«é€Ÿè§£æ</div>
                    <div class="feature-desc">å¿«é€Ÿè§£æM3U8è§†é¢‘é“¾æ¥ï¼Œæ— éœ€ç­‰å¾…</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">â©</div>
                    <div class="feature-title">å¤šå€é€Ÿæ’­æ”¾</div>
                    <div class="feature-desc">æ”¯æŒ0.5x-2.0xå¤šç§æ’­æ”¾é€Ÿåº¦è°ƒèŠ‚</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“º</div>
                    <div class="feature-title">æ¸…æ™°åº¦é€‰æ‹©</div>
                    <div class="feature-desc">è‡ªåŠ¨è¯†åˆ«å¹¶æ”¯æŒå¤šç§æ¸…æ™°åº¦åˆ‡æ¢</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”’</div>
                    <div class="feature-title">å®‰å…¨æ’­æ”¾</div>
                    <div class="feature-desc">æœ¬åœ°æ’­æ”¾ï¼Œä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨</div>
                </div>
            </div>

            <div class="remark">
                <h3>ä»€ä¹ˆæ˜¯M3U8ï¼Ÿ</h3>
                <p>
                    <strong>M3U8</strong> æ˜¯ä¸€ç§åŸºäºHTTP Live
                    Streamingï¼ˆHLSï¼‰åè®®çš„è§†é¢‘æ’­æ”¾æ ¼å¼ï¼Œå¸¸ç”¨äºåœ¨çº¿è§†é¢‘æ’­æ”¾ã€‚å®ƒå°†è§†é¢‘åˆ†å‰²æˆå¤šä¸ªå°çš„TSæ ¼å¼æ–‡ä»¶ï¼Œé€šè¿‡m3u8ç´¢å¼•æ–‡ä»¶è¿›è¡Œç®¡ç†å’ŒåŠ è½½ã€‚
                </p>

                <h3>å¦‚ä½•ä½¿ç”¨æœ¬å·¥å…·ï¼Ÿ</h3>
                <p>
                    1. åœ¨è¾“å…¥æ¡†ä¸­ç²˜è´´æ‚¨çš„M3U8è§†é¢‘æ–‡ä»¶é“¾æ¥<br>
                    2. ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æå¹¶æ’­æ”¾è§†é¢‘<br>
                    3. æ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´æ’­æ”¾é€Ÿåº¦å’Œæ¸…æ™°åº¦
                </p>
            </div>

            <div class="wise_saying">
                <b>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚â€”â€”ã€Šè®ºè¯­Â·å«çµå…¬ã€‹</b>
            </div>

            <div class="footer">
                <!-- å‹é“¾ç›´æ¥ç¡¬ç¼–ç åœ¨è¿™é‡Œ -->
                <div class="friend-links">
                    <h3>å‹æƒ…é“¾æ¥</h3>
                    <div class="links-container">
                        <a href="/website/sitemap.xml" target="_blank" rel="noopener">ç«™ç‚¹åœ°å›¾</a>
                        <a href="https://www.csdn.net/" target="_blank" rel="noopener">CSDN</a>
                        <a href="https://www.cnblogs.com/" target="_blank" rel="noopener">åšå®¢å›­</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div id="alert" class="alert"></div>

    <!-- JavaScript -->
    <script>
        // é¡µé¢å…ƒç´ 
        const m3u8Url = document.getElementById('m3u8Url');
        const playBtn = document.getElementById('playBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const clearBtn = document.getElementById('clearBtn');
        const videoPlayer = document.getElementById('videoPlayer');
        const playbackSpeed = document.getElementById('playbackSpeed');
        const qualitySelect = document.getElementById('qualitySelect');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const alert = document.getElementById('alert');

        // HLSå®ä¾‹
        let hls = null;

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(text, isError = false) {
            alert.textContent = text;
            alert.style.display = text ? 'block' : 'none';
            alert.style.color = isError ? '#ef4444' : '#0f766e';

            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            alert.style.opacity = 1;
            alert.style.animation = 'none';
            alert.offsetHeight; // è§¦å‘é‡æ’
            alert.style.animation = isError ? 'shake 0.5s' : 'fadeIn 0.5s';

            // 3ç§’åè‡ªåŠ¨éšè—
            if (text) {
                setTimeout(() => {
                    alert.style.opacity = 0;
                    setTimeout(() => {
                        alert.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show = true) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }

        // æ’­æ”¾M3U8è§†é¢‘
        function playM3U8(url) {
            // éªŒè¯URL
            if (!url || !url.trim()) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„M3U8é“¾æ¥', true);
                return;
            }

            // é‡ç½®æ’­æ”¾å™¨
            if (hls) {
                hls.destroy();
                hls = null;
            }

            videoPlayer.pause();
            videoPlayer.src = '';

            showLoading();

            try {
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒHLS
                if (Hls.isSupported()) {
                    hls = new Hls();

                    // ç›‘å¬é”™è¯¯
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        console.error('HLSé”™è¯¯:', data);
                        showLoading(false);

                        if (data.fatal) {
                            switch (data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    showAlert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆ', true);
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    showAlert('åª’ä½“é”™è¯¯ï¼Œæ— æ³•æ’­æ”¾è§†é¢‘', true);
                                    break;
                                default:
                                    showAlert('æ’­æ”¾é”™è¯¯: ' + data.details, true);
                                    break;
                            }
                        }
                    });

                    // ç›‘å¬åŠ è½½è¿›åº¦
                    hls.on(Hls.Events.BUFFER_CREATED, () => {
                        showLoading(false);
                    });

                    // ç›‘å¬æ¸…æ™°åº¦å˜åŒ–
                    hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                        updateQualitySelection();
                    });

                    // ç›‘å¬æ¸…æ™°åº¦åˆ—è¡¨åŠ è½½å®Œæˆ
                    hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
                        updateQualitySelection();
                        showLoading(false);
                    });

                    // åŠ è½½M3U8æº
                    hls.loadSource(url);
                    hls.attachMedia(videoPlayer);
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    // Safariæµè§ˆå™¨åŸç”Ÿæ”¯æŒHLS
                    videoPlayer.src = url;
                    videoPlayer.addEventListener('loadedmetadata', () => {
                        showLoading(false);
                    });
                    videoPlayer.addEventListener('error', (err) => {
                        showLoading(false);
                        showAlert('æ’­æ”¾é”™è¯¯ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆ', true);
                        console.error('è§†é¢‘æ’­æ”¾é”™è¯¯:', err);
                    });
                } else {
                    showLoading(false);
                    showAlert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒM3U8æ’­æ”¾ï¼Œè¯·æ›´æ¢æµè§ˆå™¨æˆ–ä½¿ç”¨Chrome/Firefox/Edge', true);
                }
            } catch (error) {
                showLoading(false);
                showAlert('æ’­æ”¾é”™è¯¯: ' + error.message, true);
                console.error('æ’­æ”¾M3U8è§†é¢‘æ—¶å‡ºé”™:', error);
            }
        }

        // æ›´æ–°æ¸…æ™°åº¦é€‰æ‹©
        function updateQualitySelection() {
            if (!hls || !hls.levels || hls.levels.length <= 0) {
                return;
            }

            qualitySelect.innerHTML = '';

            // æ·»åŠ è‡ªåŠ¨é€‰é¡¹
            const autoOption = document.createElement('span');
            autoOption.className = 'quality-option active';
            autoOption.textContent = 'è‡ªåŠ¨';
            autoOption.addEventListener('click', () => {
                if (hls) {
                    hls.currentLevel = -1; // è®¾ç½®ä¸ºè‡ªåŠ¨
                    updateActiveQuality(autoOption);
                    showAlert('å·²åˆ‡æ¢ä¸ºè‡ªåŠ¨æ¸…æ™°åº¦');
                }
            });
            qualitySelect.appendChild(autoOption);

            // æ·»åŠ å„æ¸…æ™°åº¦é€‰é¡¹
            hls.levels.forEach((level, index) => {
                const bitrate = level.bitrate || 0;
                const bandwidth = (bitrate / 1000000).toFixed(2);
                const option = document.createElement('span');
                option.className = 'quality-option';
                option.textContent = `${level.width || 'æœªçŸ¥'}p (${bandwidth}Mbps)`;
                option.addEventListener('click', () => {
                    if (hls) {
                        hls.currentLevel = index;
                        updateActiveQuality(option);
                        showAlert(`å·²åˆ‡æ¢ä¸º${option.textContent}æ¸…æ™°åº¦`);
                    }
                });
                qualitySelect.appendChild(option);
            });
        }

        // æ›´æ–°æ¿€æ´»çš„æ¸…æ™°åº¦é€‰é¡¹
        function updateActiveQuality(element) {
            const options = document.querySelectorAll('.quality-option');
            options.forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
        }

        // è®¾ç½®ç¤ºä¾‹è§†é¢‘
        function setSampleVideo() {
            // å¤šä¸ªç¤ºä¾‹è§†é¢‘é“¾æ¥ï¼Œå¯ä»¥éšæœºé€‰æ‹©æˆ–å¾ªç¯ä½¿ç”¨
            const sampleVideos = [
                'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
                'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                'https://playertest.longtailvideo.com/adaptive/bipbop/gear4/prog_index.m3u8'
            ];

            // éšæœºé€‰æ‹©ä¸€ä¸ªç¤ºä¾‹è§†é¢‘
            const randomIndex = Math.floor(Math.random() * sampleVideos.length);
            m3u8Url.value = sampleVideos[randomIndex];

            // è‡ªåŠ¨æ’­æ”¾
            playM3U8(m3u8Url.value);
            showAlert('å·²åŠ è½½ç¤ºä¾‹è§†é¢‘');
        }

        // æ¸…ç©ºè¾“å…¥å’Œæ’­æ”¾å™¨
        function clearPlayer() {
            if (hls) {
                hls.destroy();
                hls = null;
            }

            videoPlayer.pause();
            videoPlayer.src = '';
            m3u8Url.value = '';
            qualitySelect.innerHTML = '<span class="quality-option">è‡ªåŠ¨</span>';
            playbackSpeed.value = '1';
            showAlert('æ’­æ”¾å™¨å·²æ¸…ç©º');
        }

        // äº‹ä»¶ç›‘å¬
        playBtn.addEventListener('click', () => playM3U8(m3u8Url.value));
        sampleBtn.addEventListener('click', setSampleVideo);
        clearBtn.addEventListener('click', clearPlayer);

        // æ’­æ”¾é€Ÿåº¦è°ƒèŠ‚
        playbackSpeed.addEventListener('change', (e) => {
            videoPlayer.playbackRate = parseFloat(e.target.value);
            showAlert(`æ’­æ”¾é€Ÿåº¦å·²è°ƒæ•´ä¸º${e.target.value}x`);
        });

        // æ”¯æŒå›è½¦æ’­æ”¾
        m3u8Url.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                playM3U8(m3u8Url.value);
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å°è¯•åŠ è½½ç¤ºä¾‹è§†é¢‘
        window.addEventListener('DOMContentLoaded', () => {
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            showAlert('æ¬¢è¿ä½¿ç”¨M3U8åœ¨çº¿æ’­æ”¾å™¨ï¼Œè¯·è¾“å…¥é“¾æ¥æˆ–ç‚¹å‡»ç¤ºä¾‹è§†é¢‘å¼€å§‹æ’­æ”¾');

            // å¦‚æœURLä¸­æœ‰å‚æ•°ï¼Œåˆ™è‡ªåŠ¨åŠ è½½
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url');
            if (url) {
                m3u8Url.value = url;
                setTimeout(() => playM3U8(url), 500);
            }
        });
    </script>
</body>

</html>